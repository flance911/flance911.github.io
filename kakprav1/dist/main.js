(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{LAYERS_COUNT:()=>f,LAYER_BACK:()=>n,LAYER_CHARACTER:()=>u,LAYER_CONTROL:()=>m,LAYER_IMAGE:()=>d,LAYER_MODAL_BACK:()=>g,LAYER_MODAL_CONTROL:()=>w,LAYER_MODAL_GRAY:()=>p,backSource:()=>k,buttons:()=>b,images:()=>C});class s{SCALE=1e4;QUALITY=1.6;c;ctx;filter;clickCallback;clickCallbackCaller;mousedownCallback;mousedownCallbackCaller;mousemoveCallback;mousemoveCallbackCaller;left;right;width;height;defaultWidth;defaultHeight;mouse={over:{x:null,y:null},click:{x:null,y:null},pressed:!1,swipe:null};constructor(t="#c",e=500,s=500){this.c=document.querySelector(t),this.defaultWidth=e,this.defaultHeight=s,this.ctx=this.c.getContext("2d"),this.fixDpiNew(),this.checkBorders(),setInterval((()=>this.checkBorders()),1e3)}fixDpi=()=>{const t=window.devicePixelRatio,e=window.getComputedStyle(this.c),s=()=>+e.height.slice(0,-2),i=()=>+e.width.slice(0,-2);this.c.setAttribute("width",(i()*t).toString()),this.c.setAttribute("height",(s()*t).toString())};fixDpiNew=()=>{let t=window.devicePixelRatio*this.QUALITY;const e=this.c.getBoundingClientRect();this.c.width=e.width*t,this.c.height=e.height*t,this.ctx.scale(t,t),window.innerWidth>450?this.c.getAttribute("data-height")?(this.c.style.width=this.c.getAttribute("data-width"),this.c.style.height=this.c.getAttribute("data-height")):this.c.style.height="95vh":(this.c.style.width="100%",this.c.style.aspectRatio=window.innerWidth+"/"+window.innerHeight)};checkBorders(){this.left=this.c.offsetLeft+this.c.clientLeft,this.top=this.c.offsetTop+this.c.clientTop,this.width=this.c.offsetWidth,this.height=this.c.offsetHeight}setClickCallback(t,e){this.clickCallback=e,this.clickCallbackCaller=t}setMousedownCallback(t,e){this.mousedownCallback=e,this.mousedownCallbackCaller=t}setMousemoveCallback(t,e){this.mousemoveCallback=e,this.mousemoveCallbackCaller=t}getContext(){return this.ctx}addMouseListeners(){this.c.addEventListener("mousedown",(t=>this.mousedownListener(t))),this.c.addEventListener("touchstart",(t=>this.mousedownListener(t))),this.c.addEventListener("mouseup",(t=>this.mouseupListener(t))),this.c.addEventListener("touchend",(t=>this.mouseupListener(t))),this.c.addEventListener("mousemove",(t=>this.mousemoveListener(t))),this.c.addEventListener("touchmove",(t=>this.mousemoveListener(t)))}mousedownListener(t){let e,s;"touchstart"===t.type?(e=t.touches[0].pageX,s=t.touches[0].pageY):(e=t.pageX,s=t.pageY);let i=e-this.left,h=s-this.top;i=i/this.width*this.defaultWidth,h=h/this.height*this.defaultHeight,this.mouse.click.x=i,this.mouse.click.y=h,this.mouse.pressed=!0,this.mousedownCallback.call(this.mousedownCallbackCaller,this.mouse.click)}mouseupListener(t){let e,s;if(t.preventDefault(),"touchend"===t.type||(e=t.pageX,s=t.pageY),"touchend"!==t.type){let t=e-this.left,i=s-this.top;t=t/this.width*this.defaultWidth,i=i/this.height*this.defaultHeight,this.mouse.click.x=t,this.mouse.click.y=i}this.mouse.pressed=!1,this.clickCallback.call(this.clickCallbackCaller,this.mouse.click)}mousemoveListener(t){let e,s;"touchmove"===t.type?(e=t.touches[0].pageX,s=t.touches[0].pageY):(e=t.pageX,s=t.pageY);let i=e-this.left,h=s-this.top;i=i/this.width*this.defaultWidth,h=h/this.height*this.defaultHeight,this.mouse.pressed&&(this.mouse.swipe=i-this.mouse.over.x),this.mouse.over.x=i,this.mouse.over.y=h,this.mousemoveCallback.call(this.mousemoveCallbackCaller,this.mouse)}clearAll(){this.ctx.clearRect(0,0,this.width,this.height)}setFilter(t){this.filter=t}applyFilter(){this.filter&&(this.ctx.filter=this.filter)}}class i{FPS=40;screen;scene;timers={render:null};constructor(t,e,i){this.screen=new s(t,e,i),this.screen.setClickCallback(this,this.clickCallback),this.screen.setMousedownCallback(this,this.mousedownCallback),this.screen.setMousemoveCallback(this,this.mousemoveCallback)}clickCallback(t){this.scene.click(t)}mousedownCallback(t){this.scene.mousedown(t)}mousemoveCallback(t){this.scene.mousemove(t)}start(){this.initTimers().initListeners()}initTimers(){return this.initRenderTimer(),this}initRenderTimer(){this.timers.render=setInterval((()=>this.scene.render(this.screen)),1e3/this.FPS)}freezeRender(){this.scene.timerToFreeze=this.timers.render}initListeners(){return this.screen.addMouseListeners(),this}setScene(t){this.scene=t}getScene(){return this.scene}}class h{it;constructor(t){this.it=document.querySelector(t)}getIt(){return this.it}}class o{entities=[];timerToFreeze=!1;constructor(t){for(let e=0;e<t;e++)this.entities.push([])}append(t,e){this.entities[e].push(t)}click(t){for(const e of this.entities)for(const s of e)s.checkClick(t)}mousedown(t){for(const e of this.entities)for(const s of e)s.checkMousedown(t)}mousemove(t){for(const e of this.entities)for(const s of e)s.checkMousemove(t)}render(t){t.clearAll(),t.applyFilter();for(const e of this.entities)for(const s of e)s.draw(t.getContext());this.timerToFreeze&&(clearInterval(this.timerToFreeze),this.timerToFreeze=null)}remove(t){for(let e=0;e<this.entities.length;e++)for(let s=0;s<this.entities[e].length;s++)this.entities[e][s]===t&&this.entities[e].splice(s,1)}}class c{roundRect(t,e,s,i,h,o){return i<2*o&&(o=i/2),h<2*o&&(o=h/2),t.beginPath(),t.moveTo(e+o,s),t.arcTo(e+i,s,e+i,s+h,o),t.arcTo(e+i,s+h,e,s+h,o),t.arcTo(e,s+h,e,s,o),t.arcTo(e,s,e+i,s,o),t.closePath(),t}constructor(){}checkClick(){}checkMousedown(){}checkMousemove(){}draw(){}}class r extends c{params;sx;sy;sw;sh;constructor(t){super(),this.params=t,this.sx=void 0!==this.params.sx?this.params.sx:this.params.x,this.sy=void 0!==this.params.sy?this.params.sy:this.params.y,this.sw=this.params.swidth||this.params.width,this.sh=this.params.sheight||this.params.height}draw(t){t.drawImage(this.params.source.getIt(),this.sx,this.sy,this.sw,this.sh,this.params.x,this.params.y,this.params.width,this.params.height)}}class a extends r{handler=()=>{};constructor(t){super(t)}checkClick(t){t.x>this.params.x&&t.x<this.params.x+this.params.width&&t.y>this.params.y&&t.y<this.params.y+this.params.height&&this.getHandler()()}setHandler(t){this.handler=t}getHandler(){return this.handler}}class l extends a{roundness=10;constructor(t){super(t),this.symbol=t.symbol}draw(t){t.fillStyle=this.params.backStyle,this.roundRect(t,this.sx,this.sy,this.sw,this.sh,this.roundness),t.fill(),t.fillStyle=this.params.fontStyle,t.font=this.params.fontsize+" "+this.params.font,t.textAlign="center",t.fillText(this.params.caption,this.sx+this.sw/2,this.sy+this.sh/2+7)}}const n=1,d=2,u=3,m=4,p=5,g=6,w=7,f=8,k=new h("#back"),C={back:{sx:0,sy:0,x:0,y:0,swidth:576,sheight:1024,width:375,height:667,source:k},school:{sx:0,sy:0,x:0,y:0,swidth:576,sheight:1024,width:375,height:667}},b={gonext:{x:25,y:580,width:325,height:48,caption:"Далее",backStyle:"#EB5717",fontStyle:"white",fontsize:"18px",font:"Arial"}},y={};Object.entries(e).forEach((([t,e])=>y[t]=e)),new class{game;resources;constructor(t,e,s){this.game=new i(t,e,s),this.resources=document.getElementById("resources")}start(){this.game.start(),this.setNullScene()}setNullScene(){const t=new o(y.LAYERS_COUNT);t.append(new r(y.images.back),y.LAYER_BACK),setTimeout((()=>{const e=new l(y.buttons.gonext);e.setHandler((()=>{this.school()})),t.append(e,y.LAYER_CONTROL)}),2e3),this.game.setScene(t)}school(){const t=new o(y.LAYERS_COUNT),e=document.createElement("img");e.src="img/school.png",e.id="school",resources.appendChild(e),y.images.school.source=new h("#school"),t.append(new r(y.images.school),y.LAYER_BACK),e.decode().then((()=>{this.game.setScene(t)})).catch((()=>{}))}}("#c",375,667).start()})();